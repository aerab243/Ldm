# Makefile simplifi√© pour test AddURL
# Test de l'extraction automatique du nom de fichier

PROJECT_NAME = test_addurl_simple
TARGET = $(PROJECT_NAME)
BUILD_DIR = build

# Compiler et outils
CXX = g++
MOC = /usr/lib64/qt6/libexec/moc

# Configuration Qt6
QT_LIBS = $(shell pkg-config --libs Qt6Core Qt6Widgets)
QT_CFLAGS = $(shell pkg-config --cflags Qt6Core Qt6Widgets)

# Flags du compilateur
CXXFLAGS = -std=c++20 -Wall -Wextra -O2
INCLUDES = -I. $(QT_CFLAGS)

# Fichier source principal
MAIN_SOURCE = test_addurl_simple.cpp

# Cr√©er le r√©pertoire de build
$(shell mkdir -p $(BUILD_DIR))

# Cible par d√©faut
all: $(TARGET)

# Cible principale
$(TARGET): $(MAIN_SOURCE)
	@echo "üìù G√©n√©ration du fichier MOC..."
	$(MOC) $(INCLUDES) $(MAIN_SOURCE) -o $(BUILD_DIR)/test_addurl_simple.moc
	@echo "üìã Copie du fichier MOC..."
	cp $(BUILD_DIR)/test_addurl_simple.moc test_addurl_simple.moc
	@echo "üî® Compilation de $(TARGET)..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $(MAIN_SOURCE) -o $(TARGET) $(QT_LIBS)
	@echo "‚úÖ Build termin√©: $(TARGET)"

# Nettoyer
clean:
	@echo "üßπ Nettoyage..."
	rm -f $(TARGET)
	rm -f $(BUILD_DIR)/*.moc
	rm -f *.moc
	@echo "‚úÖ Nettoyage termin√©"

# Ex√©cuter le test
run: $(TARGET)
	@echo "üöÄ Lancement du test AddURL..."
	./$(TARGET)

# V√©rifier les d√©pendances
check-deps:
	@echo "üîç V√©rification des d√©pendances..."
	@pkg-config --exists Qt6Core && echo "‚úÖ Qt6Core trouv√©" || echo "‚ùå Qt6Core manquant"
	@pkg-config --exists Qt6Widgets && echo "‚úÖ Qt6Widgets trouv√©" || echo "‚ùå Qt6Widgets manquant"
	@which $(CXX) > /dev/null && echo "‚úÖ $(CXX) trouv√©" || echo "‚ùå $(CXX) manquant"
	@test -f $(MOC) && echo "‚úÖ MOC trouv√©" || echo "‚ùå MOC manquant"

# Debug
debug:
	$(MAKE) CXXFLAGS="$(CXXFLAGS) -g -DDEBUG"

# Aide
help:
	@echo "üìñ Cibles disponibles:"
	@echo "  all        - Compiler l'application (d√©faut)"
	@echo "  clean      - Nettoyer les fichiers de build"
	@echo "  run        - Compiler et ex√©cuter"
	@echo "  debug      - Compiler en mode debug"
	@echo "  check-deps - V√©rifier les d√©pendances"
	@echo "  help       - Afficher cette aide"

.PHONY: all clean run debug check-deps help
